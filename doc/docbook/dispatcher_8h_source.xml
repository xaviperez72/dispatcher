<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="_dispatcher_8h_source" xml:lang="en-US">
<title>dispatcher.h</title>
<indexterm><primary>src/dispatcher.h</primary></indexterm>
Go to the documentation of this file.<programlisting linenumbering="unnumbered"><anchor xml:id="_dispatcher_8h_source_1l00001"/>00001 <emphasis role="preprocessor">#ifndef&#32;DISPATCHER_H</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00002"/>00002 <emphasis role="preprocessor">#define&#32;DISPATCHER_H</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00003"/>00003 
<anchor xml:id="_dispatcher_8h_source_1l00004"/>00004 <emphasis role="preprocessor">#include&#32;&lt;sys/socket.h&gt;</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00005"/>00005 <emphasis role="preprocessor">#include&#32;&lt;netinet/in.h&gt;</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00006"/>00006 <emphasis role="preprocessor">#include&#32;&lt;json/json.h&gt;</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00007"/>00007 <emphasis role="preprocessor">#include&#32;&lt;json/value.h&gt;</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00008"/>00008 <emphasis role="preprocessor">#include&#32;&lt;memory&gt;</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00009"/>00009 
<anchor xml:id="_dispatcher_8h_source_1l00010"/>00010 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_common_8h">common.h</link>&quot;</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00011"/>00011 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_dispatch__cfg_8h">dispatch_cfg.h</link>&quot;</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00012"/>00012 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_checker__pids_8h">checker_pids.h</link>&quot;</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00013"/>00013 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_Socket_8h">Socket.h</link>&quot;</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00014"/>00014 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_connections_8h">connections.h</link>&quot;</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00015"/>00015 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_getcfgfile_8h">getcfgfile.h</link>&quot;</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00016"/>00016 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_ipclib_8h">ipclib.h</link>&quot;</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00017"/>00017 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_thread__pair_8h">thread_pair.h</link>&quot;</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00018"/>00018 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_protocol__msg_8h">protocol_msg.h</link>&quot;</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00019"/>00019 
<anchor xml:id="_dispatcher_8h_source_1l00020"/><link linkend="_structallowed__ips">00020</link> <emphasis role="keyword">struct&#32;</emphasis><link linkend="_structallowed__ips">allowed_ips</link>
<anchor xml:id="_dispatcher_8h_source_1l00021"/>00021 {
<anchor xml:id="_dispatcher_8h_source_1l00022"/><link linkend="_structallowed__ips_1a6bf24aea2a2a3024273ce87e694b5083">00022</link> &#32;&#32;&#32;&#32;<emphasis role="keywordtype">bool</emphasis>&#32;<link linkend="_structallowed__ips_1a6bf24aea2a2a3024273ce87e694b5083">trace</link>{<emphasis role="keyword">false</emphasis>};
<anchor xml:id="_dispatcher_8h_source_1l00023"/><link linkend="_structallowed__ips_1a52a2adb3f9b2453095119df134014c6d">00023</link> &#32;&#32;&#32;&#32;<emphasis role="keywordtype">bool</emphasis>&#32;<link linkend="_structallowed__ips_1a52a2adb3f9b2453095119df134014c6d">allowed</link>{<emphasis role="keyword">true</emphasis>};
<anchor xml:id="_dispatcher_8h_source_1l00024"/><link linkend="_structallowed__ips_1af31d36eb6ad012eee4f5c0564f04ec63">00024</link> &#32;&#32;&#32;&#32;in_addr&#32;<link linkend="_structallowed__ips_1af31d36eb6ad012eee4f5c0564f04ec63">ip</link>;
<anchor xml:id="_dispatcher_8h_source_1l00025"/>00025 };
<anchor xml:id="_dispatcher_8h_source_1l00026"/>00026 
<anchor xml:id="_dispatcher_8h_source_1l00027"/><link linkend="_classDispatcher">00027</link> <emphasis role="keyword">class&#32;</emphasis><link linkend="_classDispatcher">Dispatcher</link>&#32;{
<anchor xml:id="_dispatcher_8h_source_1l00028"/><link linkend="_classDispatcher_1a16272dd720e97587260cd1d85b8d9cd8">00028</link> &#32;&#32;&#32;&#32;<link linkend="_structdispatch__cfg">dispatch_cfg</link>&#32;<link linkend="_classDispatcher_1a16272dd720e97587260cd1d85b8d9cd8">_config</link>;
<anchor xml:id="_dispatcher_8h_source_1l00029"/>00029 
<anchor xml:id="_dispatcher_8h_source_1l00030"/><link linkend="_classDispatcher_1a023871cf97965bcfe33681aec45c0278">00030</link> &#32;&#32;&#32;&#32;std::vector&lt;thread_pair&gt;&#32;<link linkend="_classDispatcher_1a023871cf97965bcfe33681aec45c0278">_v_thread_pair</link>;
<anchor xml:id="_dispatcher_8h_source_1l00031"/>00031 
<anchor xml:id="_dispatcher_8h_source_1l00032"/><link linkend="_classDispatcher_1a030d89cc64de3ef18b775e563da891e1">00032</link> &#32;&#32;&#32;&#32;std::shared_ptr&lt;keep_running_flags&gt;&#32;<link linkend="_classDispatcher_1a030d89cc64de3ef18b775e563da891e1">_sharedptr_keep_running</link>;
<anchor xml:id="_dispatcher_8h_source_1l00033"/>00033 
<anchor xml:id="_dispatcher_8h_source_1l00034"/><link linkend="_classDispatcher_1aa5cca577db5505a89119c00b931fffa5">00034</link> &#32;&#32;&#32;&#32;std::shared_ptr&lt;Semaphore&gt;&#32;<link linkend="_classDispatcher_1aa5cca577db5505a89119c00b931fffa5">_shpt_semIPCfile</link>;
<anchor xml:id="_dispatcher_8h_source_1l00035"/>00035 
<anchor xml:id="_dispatcher_8h_source_1l00036"/><link linkend="_classDispatcher_1a01fe79a912713358c99828dd8ae33eb4">00036</link> &#32;&#32;&#32;&#32;std::shared_ptr&lt;SharedMemory&gt;&#32;<link linkend="_classDispatcher_1a01fe79a912713358c99828dd8ae33eb4">_shpt_shmIPCfile</link>;
<anchor xml:id="_dispatcher_8h_source_1l00037"/>00037 
<anchor xml:id="_dispatcher_8h_source_1l00038"/><link linkend="_classDispatcher_1a9d048f400c300c407c5a62c3b4197996">00038</link> &#32;&#32;&#32;&#32;<link linkend="_classSocket">Socket</link>&#32;<link linkend="_classDispatcher_1a9d048f400c300c407c5a62c3b4197996">_server_socket</link>;
<anchor xml:id="_dispatcher_8h_source_1l00039"/>00039 &#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Shared&#32;Connections&#32;between&#32;dispatcher&#32;and&#32;tuxclients</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00040"/><link linkend="_classDispatcher_1a4ef272a9b4eb41f62c6f28e6f790b7e8">00040</link> &#32;&#32;&#32;&#32;std::shared_ptr&lt;connections&gt;&#32;<link linkend="_classDispatcher_1a4ef272a9b4eb41f62c6f28e6f790b7e8">_p_cur_connections</link>;
<anchor xml:id="_dispatcher_8h_source_1l00041"/>00041 
<anchor xml:id="_dispatcher_8h_source_1l00042"/>00042 &#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Common&#32;message&#32;queue&#32;-&#32;All&#32;receiving&#32;messages&#32;go&#32;here.&#32;</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00043"/><link linkend="_classDispatcher_1a617169aea8a4c5caec50400a86401466">00043</link> &#32;&#32;&#32;&#32;std::shared_ptr&lt;MessageQueue&gt;&#32;<link linkend="_classDispatcher_1a617169aea8a4c5caec50400a86401466">_shpt_Common_Msg_Queue</link>;
<anchor xml:id="_dispatcher_8h_source_1l00044"/>00044 &#32;&#32;&#32;&#32;
<anchor xml:id="_dispatcher_8h_source_1l00045"/>00045 &#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Allowed&#32;IP&apos;s&#32;-&#32;Used&#32;by&#32;Accept_Thread&#32;(mainly),&#32;Reader&#32;and&#32;Writer&#32;for&#32;logging&#32;purposes.&#32;</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00046"/>00046 &#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Sempahore&#32;not&#32;needed.</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00047"/><link linkend="_classDispatcher_1ac81547d0bc6aa870455e218ae8bb58e8">00047</link> &#32;&#32;&#32;&#32;std::shared_ptr&lt;SharedMemory&gt;&#32;<link linkend="_classDispatcher_1ac81547d0bc6aa870455e218ae8bb58e8">_shpt_shmAllowedIPs</link>;
<anchor xml:id="_dispatcher_8h_source_1l00048"/><link linkend="_classDispatcher_1aa86de669ffc45c71db171db702c2c939">00048</link> &#32;&#32;&#32;&#32;<link linkend="_structallowed__ips">allowed_ips</link>&#32;*<link linkend="_classDispatcher_1aa86de669ffc45c71db171db702c2c939">_allowed_ips</link>;
<anchor xml:id="_dispatcher_8h_source_1l00049"/>00049 
<anchor xml:id="_dispatcher_8h_source_1l00050"/><link linkend="_classDispatcher_1aae40315ea44ae1b054a663fbefae653d">00050</link> &#32;&#32;&#32;&#32;std::vector&lt;MessageQueue&gt;&#32;<link linkend="_classDispatcher_1aae40315ea44ae1b054a663fbefae653d">_msg_queues</link>;
<anchor xml:id="_dispatcher_8h_source_1l00051"/>00051 &#32;&#32;&#32;&#32;<emphasis role="comment">//std::shared_ptr&lt;signal_synch&gt;&#32;_shpt_sigsyn;</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00052"/>00052 
<anchor xml:id="_dispatcher_8h_source_1l00053"/>00053 <emphasis role="keyword">public</emphasis>:
<anchor xml:id="_dispatcher_8h_source_1l00054"/><link linkend="_classDispatcher_1a81afc8d131f2724e92e6ca1d68aae6ae">00054</link> &#32;&#32;&#32;&#32;<link linkend="_classDispatcher_1a81afc8d131f2724e92e6ca1d68aae6ae">Dispatcher</link>()&#32;=&#32;<emphasis role="keyword">delete</emphasis>;
<anchor xml:id="_dispatcher_8h_source_1l00055"/>00055 &#32;&#32;&#32;&#32;<link linkend="_classDispatcher_1a81afc8d131f2724e92e6ca1d68aae6ae">Dispatcher</link>(<link linkend="_structdispatch__cfg">dispatch_cfg</link>&#32;cfg,&#32;std::shared_ptr&lt;keep_running_flags&gt;&#32;shpt_keep_running);
<anchor xml:id="_dispatcher_8h_source_1l00056"/>00056 &#32;&#32;&#32;&#32;<link linkend="_classDispatcher_1a52fc4e8bef278fa415723b39b61c28a7">~Dispatcher</link>();
<anchor xml:id="_dispatcher_8h_source_1l00057"/>00057 
<anchor xml:id="_dispatcher_8h_source_1l00058"/>00058 &#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Constructor&#32;de&#32;copia</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00059"/>00059 &#32;&#32;&#32;&#32;<link linkend="_classDispatcher_1a81afc8d131f2724e92e6ca1d68aae6ae">Dispatcher</link>(<emphasis role="keyword">const</emphasis>&#32;<link linkend="_classDispatcher">Dispatcher</link>&amp;&#32;other);
<anchor xml:id="_dispatcher_8h_source_1l00060"/>00060 
<anchor xml:id="_dispatcher_8h_source_1l00061"/>00061 &#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Operador&#32;de&#32;asignación&#32;por&#32;copia</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00062"/>00062 &#32;&#32;&#32;&#32;<link linkend="_classDispatcher">Dispatcher</link>&amp;&#32;<link linkend="_classDispatcher_1a81c3a5eace0c1f1994a3ec6c6f2c3489">operator=</link>(<emphasis role="keyword">const</emphasis>&#32;<link linkend="_classDispatcher">Dispatcher</link>&amp;&#32;other);
<anchor xml:id="_dispatcher_8h_source_1l00063"/>00063 
<anchor xml:id="_dispatcher_8h_source_1l00064"/>00064 &#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Constructor&#32;de&#32;movimiento</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00065"/>00065 &#32;&#32;&#32;&#32;<link linkend="_classDispatcher_1a81afc8d131f2724e92e6ca1d68aae6ae">Dispatcher</link>(<link linkend="_classDispatcher">Dispatcher</link>&amp;&amp;&#32;other)&#32;<emphasis role="keyword">noexcept</emphasis>;
<anchor xml:id="_dispatcher_8h_source_1l00066"/>00066 
<anchor xml:id="_dispatcher_8h_source_1l00067"/>00067 &#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Operador&#32;de&#32;asignación&#32;por&#32;movimiento</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00068"/>00068 &#32;&#32;&#32;&#32;<link linkend="_classDispatcher">Dispatcher</link>&amp;&#32;<link linkend="_classDispatcher_1a81c3a5eace0c1f1994a3ec6c6f2c3489">operator=</link>(<link linkend="_classDispatcher">Dispatcher</link>&amp;&amp;&#32;other)&#32;<emphasis role="keyword">noexcept</emphasis>;
<anchor xml:id="_dispatcher_8h_source_1l00069"/>00069 &#32;&#32;&#32;&#32;
<anchor xml:id="_dispatcher_8h_source_1l00070"/>00070 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_classDispatcher_1a8847de325dbee771fb33ebebb978e40d">Launch_All_Threads</link>();
<anchor xml:id="_dispatcher_8h_source_1l00071"/>00071 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_classDispatcher_1ab58d2e0054dd8833324bc86095af82ba">Prepare_Server_Socket</link>();
<anchor xml:id="_dispatcher_8h_source_1l00072"/>00072 &#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;void&#32;Signal_Handler_For_Threads();</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00073"/>00073 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_classDispatcher_1af6b72f91b36ed0dcee31684992b725a6">IPC_Setting_Up</link>();
<anchor xml:id="_dispatcher_8h_source_1l00074"/>00074 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_classDispatcher_1a8f47f787819c857ebd5870ce8f24a787">Accept_Thread</link>();
<anchor xml:id="_dispatcher_8h_source_1l00075"/>00075 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_classDispatcher_1a1bdce929609ef90ec793b33f004eb256">Assign_connection_to_thread_pair</link>(<emphasis role="keywordtype">int</emphasis>&#32;th_id,&#32;<link linkend="_structsocket__data__t">socket_data_t</link>&#32;*sd_info);
<anchor xml:id="_dispatcher_8h_source_1l00076"/>00076 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_classDispatcher_1a802fc1e47691fdf18a24434256fe2680">Accept_by_Select</link>();
<anchor xml:id="_dispatcher_8h_source_1l00077"/>00077 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_classDispatcher_1ac4cda43fd65ddf8fda5ae010f4e460ef">Ending_all_threads</link>();
<anchor xml:id="_dispatcher_8h_source_1l00078"/>00078 &#32;&#32;&#32;&#32;<emphasis role="comment">//void&#32;Show_All_Shared_Ptr();</emphasis>
<anchor xml:id="_dispatcher_8h_source_1l00079"/>00079 
<anchor xml:id="_dispatcher_8h_source_1l00080"/>00080 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_classDispatcher_1a36ada166664995d1fca7676ebae0bacd">LessCharged</link>();
<anchor xml:id="_dispatcher_8h_source_1l00081"/>00081 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_classDispatcher_1a667b6987746aaff43e0c5635a9e5226a">LaunchTuxCli</link>();
<anchor xml:id="_dispatcher_8h_source_1l00082"/>00082 &#32;&#32;&#32;&#32;<emphasis role="keyword">operator</emphasis>&#32;bool();
<anchor xml:id="_dispatcher_8h_source_1l00083"/>00083 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_classDispatcher_1ac0191211316636f5e5dea1d6ee5a80ae">operator()</link>();
<anchor xml:id="_dispatcher_8h_source_1l00084"/>00084 };
<anchor xml:id="_dispatcher_8h_source_1l00085"/>00085 
<anchor xml:id="_dispatcher_8h_source_1l00086"/>00086 <emphasis role="preprocessor">#endif</emphasis>
</programlisting></section>
